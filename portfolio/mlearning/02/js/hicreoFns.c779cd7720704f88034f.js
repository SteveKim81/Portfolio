!function(e){function t(t){for(var r,i,c=t[0],s=t[1],u=t[2],d=0,f=[];d<c.length;d++)i=c[d],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&f.push(a[i][0]),a[i]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);for(l&&l(t);f.length;)f.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,c=1;c<n.length;c++){var s=n[c];0!==a[s]&&(r=!1)}r&&(o.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},a={1:0},o=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.e=function(){return Promise.resolve()},i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var c=window.webpackJsonp=window.webpackJsonp||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var l=s;o.push([117,0]),n()}({116:function(e,t,n){"use strict";var r=function(e){var t=e.lsId,n=e.pageInfo,r=(e.isPageLoadedBefore,window.Stage.prop("contentWindow"));r.PageDataHandler({action:"set.currentPage",lsId:t}),r.PageDataHandler({action:"set.currentLayer",lsId:t}),r.GlobalMouseUP(),r.PageDataHandler({action:"init.pageData",lsId:t});var a=window.FindElInStage("#lsPage_"+t);window.FindElInStage(".lsPage").hide(),a.show(),a.find(".eyedropper_cursor").remove(),window.Stage.contents().find("#iContent").removeAttr("src"),window.timeline_point=n.timepoint,window.CookieHandler({type:"set",name:"timeline.timepointer",val:window.timeline_point}),r.scrollLength.left=window.Stage.contents().scrollLeft(),r.scrollLength.top=window.Stage.contents().scrollTop(),a.find("layer").toArray().forEach((function(e){creoFns.R.compose(window.AddGroupChildren,window.GetObjsInLayer,window.MakejQuery)(e).forEach((function(e){switch("34"===window.projectType&&e.getAttribute("role"),e.getAttribute("role")){case"R003":$(e).audioPlayer();break;case"R005":$(e).videoPlayer();break;case"R010":creoFns.R.compose(r.ChartInit,window.MakejQuery)(e);break;case"R035":r.mLearningHandler({type:"init.R035",obj:e})}}))})),r.GuidelineHandler({type:"init"}),window.SetContentBlockMenu({lsId:t}),window.EventToSidebar({type:"loadMenu",id:t}),$.ajax({url:"authoring_ajax.php",type:"POST",data:{func:"SetLsId",ls_id:t}}),function(){var e=window.GetHicreoDialogStack();if(e.length>0){var t=e.reverse()[0].mainLayer;"R008"===t.attr("role")?(window.R006EditorHandler({action:"destroy"}),window.R008Handler({action:"init"}),e.reverse().forEach((function(e){var t=e.callerObj,n=e.widget;"R008"===e.mainLayer.attr("role")&&n.find(".topName input").val(t.attr("name"))}))):"R006"===t.attr("role")&&window.R006EditorHandler({action:"open",after:function(){window.R006EditorHandler({action:"patchAll.itemInLayer"})}})}else 0===e.length&&window.R006EditorHandler({action:"destroy"})}(),r.InitEditorItems(),r.GroupHandler({action:"update.size"});var o=r.QuizHandler({action:"check.isQuizPage"}),i=r.CertificateHandler({action:"check.isCertificatePage"});if("200"===o)window.FindElInStage("#controller_block_id").hide(),window.KeyboardEventHandler({action:"on.quizCreatorPage"}),r.StageSelectableHandler("off"),r.QuizCreatorHandler({action:"init",lsId:t}),r.PageSizeHandler({action:"update.size",height:a.find(".quizContainer").outerHeight(!0)}),r.ResetPagePosition({scrollTop:0});else if(parseInt(o)>200&&parseInt(o)<300){var c=a.find(".questionTemplate"),s=r.QuizHandler({action:"get.quizInfo",lsId:t});!0===r.QuizHandler({action:"get.questionInfo",quizInfo:s,lsId:t}).fromQuizBank?r.QuizHandler({action:"set.pageQuizBank",page:a}):"forQuizBank"===creoFns.core.getUUIDFromId(a.attr("id"))?window.QuestionBankHandler({action:"init.event"}):0===c.length?r.QuizHandler({action:"set.pageWarningMessage",page:a}):"201"!==o&&"202"!==o&&r.QuizHandler({action:"set.saveToQuizBankButton",page:a}),r.QuizHandler({action:"init.pageData",lsId:t}).then((function(){r.QuizHandler({action:"init.pageEvent",lsId:t}),window.FindElInStage("#controller_block_id").show(),window.FindElInStage("#btnPageProperties").hide(),window.KeyboardEventHandler({action:"on.questionPage"}),r.StageSelectableHandler("off"),r.PageSizeHandler({action:"set.appropriateSize"}),r.ResetPagePosition({scrollTop:0})}))}else i?(r.CertificateHandler({action:"init.pageData",lsId:t}),r.CertificateHandler({action:"init.pageEvent",lsId:t}),window.FindElInStage("#controller_block_id").show(),window.FindElInStage("#btnPageProperties").hide(),window.KeyboardEventHandler({action:"on.certificatePage"}),r.StageSelectableHandler("off"),r.PageSizeHandler({action:"set.appropriateSize"}),r.ResetPagePosition({keepScroll:!0})):"0"!==n.groupType||"100"!==n.pageType&&"400"!==n.pageType||(window.FindElInStage("#controller_block_id, #btnPageProperties").show(),window.KeyboardEventHandler({action:"on.defaultPage"}),r.StageSelectableHandler("on"),r.PageSizeHandler({action:"set.appropriateSize"}),r.ResetPagePosition({keepScroll:!0}),"34"===window.projectType&&setTimeout((function(){r.ResetPagePosition({keepScroll:!0})}),100))};function a(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return c=e.done,e},e:function(e){s=!0,i=e},f:function(){try{c||null==n.return||n.return()}finally{if(s)throw i}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t,n,r,a,o,i){try{var c=e[o](i),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,a)}function l(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){u(o,r,a,i,c,"next",e)}function c(e){u(o,r,a,i,c,"throw",e)}i(void 0)}))}}var d=function(e){var t=creoFns.R.compose(JSON.parse,creoFns.R.join(""),creoFns.R.slice(1,1/0),creoFns.R.split("=")),n=function(e){return new Promise((function(n,r){fetch(creoFns.ownerGlobalJsonPath+e,{cache:"no-cache"}).then((function(e){return e.text()})).then((function(e){n(t(e))})).catch((function(e){r(e)}))}))},o=function(){var e=l(regeneratorRuntime.mark((function e(t){var a,o,i,c,s,u,l,d,f,g,p,b,w,v,y,m,h,O,P,S;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.action,o=t.pageUniqueId,"string"==typeof a){e.next=4;break}return console.error("Wrong param"),e.abrupt("return");case 4:e.t0=a,e.next="stage.update.pageSize"===e.t0?7:"stage.update.dimension"===e.t0?18:"stage.update.pageProperties"===e.t0?33:"stage.editEnd.contentblockCode"===e.t0?40:"stage.update.quizPage"===e.t0?44:"stage.save.quizBuilder"===e.t0?51:"stage.update.theme"===e.t0?71:"sidebar.update.theme"===e.t0?79:"all.save.quizBankPageData"===e.t0?83:"all.save.quizBankQuestionData"===e.t0?87:91;break;case 7:return i=window.globalCourseData.visualSize.innerWidth,c=window.globalCourseData.visualSize.innerHeight,e.next=11,n("courseData.js");case 11:return window.globalCourseData=e.sent,s=parseInt(window.globalCourseData.visualSize.innerWidth),u=parseInt(window.globalCourseData.visualSize.innerHeight),$("#page-width-input").val(s),$("#page-height-input").val(u),updatePageSize.call({lsId:window.global_LS_id,originalPageSize:{width:i,height:c},newPageSize:{width:s,height:u}}),e.abrupt("return");case 18:if(!$("#page-dimension-selector").length){e.next=32;break}return l={width:window.globalCourseData.visualSize.innerWidth,height:window.globalCourseData.visualSize.innerHeight},e.next=22,n("courseData.js");case 22:return window.globalCourseData=e.sent,e.next=25,n("pageData.js");case 25:return window.globalPageData=e.sent,e.next=28,n("quizData.js");case 28:window.globalQuizData=e.sent,d={width:window.globalCourseData.visualSize.innerWidth,height:window.globalCourseData.visualSize.innerHeight},-1!==(f=$("#page-dimension-selector .dd-option-value").toArray().findIndex((function(e){return e.value==="".concat(window.globalCourseData.visualSize.innerWidth,"-").concat(window.globalCourseData.visualSize.innerHeight,"-").concat(window.globalCourseData.visualSize.dimensionId)})))&&$("#page-dimension-selector").ddslick("select",{index:f,originalPageSize:l,newPageSize:d});case 32:return e.abrupt("return");case 33:return e.next=35,n("courseData.js");case 35:return window.globalCourseData=e.sent,e.next=38,n("pageData.js");case 38:return window.globalPageData=e.sent,e.abrupt("break",92);case 40:return e.next=42,n("A006Variables.js");case 42:return window.globalA006Variables=e.sent,e.abrupt("break",92);case 44:return e.next=46,n("pageData.js");case 46:return window.globalPageData=e.sent,e.next=49,n("quizData.js");case 49:return window.globalQuizData=e.sent,e.abrupt("break",92);case 51:return e.next=53,n("pageData.js");case 53:return window.globalPageData=e.sent,e.next=56,n("quizData.js");case 56:return window.globalQuizData=e.sent,g=creoFns.core.getRootWindowObject(),p=g.GetStageWindowObject(),b=g.global_LS_id,w=p.QuizHandler({action:"get.quizInfo",lsId:b}),g.EventToSidebar({type:"execute.sidebarMenuHandler",param:{action:"init.menuView",currentLsId:o}}),g.EventToSidebar({type:"execute.sidebarMenuHandler",param:{action:"update.menuController",currentLsId:o}}),g.EventToSidebar({type:"execute.outlinePanel"}),g.EventToSidebar({type:"execute.uiController"}),e.next=67,Promise.all(Object.keys(window.globalQuizData[o].questions).map((function(e){return new Promise((function(t){!0!==window.globalQuizData[o].questions[e].fromQuizBank?p.QuizHandler({action:"init.pageData",lsId:e}).then((function(){t()})):t()}))})));case 67:return w?g.EventToSidebar({type:"load.page",lsId:o}):p.QuizCreatorHandler({action:"init",lsId:o}),p.PageSizeHandler({action:"set.appropriateSize"}),p.ResetPagePosition({keepScroll:!0}),e.abrupt("return");case 71:return e.next=73,n("courseData.js");case 73:return window.globalCourseData=e.sent,(v=creoFns.core.getRootWindowObject()).UpdateThemeSetting({type:"update.sidebarPosition",data:{position:window.globalCourseData.menubar.sidebarPosition}}),v.UpdateThemeSetting({type:"update.backgroundColor",data:{color:window.globalCourseData.theme.backgroundColor}}),""!==window.globalCourseData.theme.backgroundTextureSrc&&v.UpdateThemeSetting({type:"update.backgroundTexture",data:{fileDirectory:"images/theme/",textureSrc:window.globalCourseData.theme.backgroundTextureSrc}}),e.abrupt("return");case 79:return e.next=81,n("courseData.js");case 81:return window.globalCourseData=e.sent,e.abrupt("return");case 83:return e.next=85,n("quizBankPageData.js");case 85:return window.globalQuizBankPageData=e.sent,e.abrupt("return");case 87:return e.next=89,n("quizBankQuestionData.js");case 89:return window.globalQuizBankQuestionData=e.sent,e.abrupt("return");case 91:return e.abrupt("break",92);case 92:e.t1=a.split(".")[0],e.next="all"===e.t1||"stage"===e.t1||"timeline"===e.t1?95:"sidebar"===e.t1?110:"glossary"===e.t1?111:"resources"===e.t1?116:121;break;case 95:if(y=creoFns.core.getRootWindowObject(),m=y.GetStageWindowObject(),!((h=$(m.document.querySelector("#lsPage_"+o))).length>0&&"true"===h.attr("loaded"))){e.next=109;break}return e.next=101,n("pageData.js");case 101:return O=e.sent,e.next=104,n("quizData.js");case 104:return P=e.sent,e.next=107,n("A006Variables.js");case 107:S=e.sent,creoFns.collaboration.ajaxControl.getPageHtmlDataFromServer(o).then((function(e){if(!1!==e){var t=e.pageStyle,n=e.mainLayerHtml;if(t){var a=$("<div>").attr("style",t);h.css({"background-color":a.css("background-color"),"background-image":a.css("background-image")})}if(n){h.html(n),h.find("img, audio, video").toArray().forEach((function(e){var t="content/",n=e.getAttribute("src");if(new RegExp("^(/{1,})?((../){1,})?content/").test(n)){var r=n.search(new RegExp(t));if(-1!==r){var a=".."+creoFns.ownerContentPath+n.slice(r+t.length);if(e.setAttribute("src",a),"34"===window.projectType)if("IMG"===e.nodeName)if("m1"===e.parentElement.parentElement.getAttribute("data-type"))e.parentElement.style.backgroundImage="url("+e.getAttribute("src")+")"}}}));var i=creoFns.core.getUUIDFromId(h.attr("id"));if(i===y.global_LS_id){var c=m.PageDataHandler({action:"get.pageData",lsId:o});m.PageDataHandler({action:"get.pageData",lsId:o,pageData:O}).pageInfo=c.pageInfo,window.globalPageData=O,P[o]&&(P[o]=creoFns.R.clone(window.globalQuizData[o])),window.globalQuizData=P,window.globalA006Variables=S,m.PageDataHandler({action:"set.currentLayerId",lsId:i,layerId:"layer_main"}),r({lsId:i,pageInfo:m.PageDataHandler({action:"get.pageInfo",lsId:i}),isPageLoadedBefore:!0})}}}}));case 109:case 110:return e.abrupt("break",122);case 111:return e.next=113,n("glossaryData.js");case 113:return window.globalGlossaryData=e.sent,window.EventToHelp("page.update"),e.abrupt("break",122);case 116:return e.next=118,n("resourcesData.js");case 118:return window.globalResourcesData=e.sent,window.EventToResources("page.update"),e.abrupt("break",122);case 121:return e.abrupt("break",122);case 122:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return c(c({},e),{},{syncPage:function(e){return l(regeneratorRuntime.mark((function t(){var n,r,i,c,s,u,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.uniqueIds,r=e.action,!(Array.isArray(n)&&n.length>0&&n.every((function(e){return"string"==typeof(null==e?void 0:e.pageUniqueId)&&"string"==typeof(null==e?void 0:e.layerUniqueId)})))){t.next=26;break}t.t0=r,t.next="stage.update.dimension"===t.t0?5:8;break;case 5:return t.next=7,o({action:r,uniqueIds:n});case 7:return t.abrupt("break",26);case 8:i=a(n),t.prev=9,i.s();case 11:if((c=i.n()).done){t.next=17;break}return s=c.value,u=s.pageUniqueId,l=s.layerUniqueId,t.next=15,o({action:r,pageUniqueId:u,layerUniqueId:l});case 15:t.next=11;break;case 17:t.next=22;break;case 19:t.prev=19,t.t1=t.catch(9),i.e(t.t1);case 22:return t.prev=22,i.f(),t.finish(22);case 25:return t.abrupt("break",26);case 26:case"end":return t.stop()}}),t,null,[[9,19,22,25]])})))()}})};function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){b(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var w=function(e){var t=e.courseId;return function(e){return p(p({},e),{},{getCollaborationSelfInfoFromServer:function(){return new Promise((function(e){$.ajax({url:"authoring_collaboration_ajax.php",type:"POST",data:{func:"GetCollaborationSelfInfo",courseId:t},success:function(t){var n=JSON.parse(t);creoFns.R.isEmpty(n)&&"object"!==f(n)&&!n?e({errorCode:"100"}):e({errorCode:null,hasParticipantPermission:"1"===n.participant,hasEditingPermission:"1"===n.editor})},error:function(){e({errorCode:"101"})}})}))},getCollaborationUserListFromServer:function(){return new Promise((function(e){$.ajax({url:"authoring_collaboration_ajax.php",type:"POST",data:{func:"GetCollaborationUserList",courseId:t},dataType:"JSON",success:function(t){e(t)},error:function(){e(!1)}})}))},insertNewChatContentToDB:function(e){return new Promise((function(n){$.ajax({url:"authoring_collaboration_ajax.php",type:"POST",data:{func:"InsertChatContent",text:e,courseId:t},success:function(e){n(function(){try{return JSON.parse(e)}catch(e){return!1}}())},error:function(){n(!1)}})}))},getChatLogContentsInfoFromServer:function(){return new Promise((function(e){$.ajax({url:"authoring_collaboration_ajax.php",type:"POST",data:{func:"GetChatLogContents",courseId:t},dataType:"JSON",success:function(t){e(t)},error:function(){e(!1)}})}))},getPageHtmlDataFromServer:function(e){return new Promise((function(n,r){$.ajax({url:"authoring_collaboration_ajax.php",type:"POST",data:{func:"GetWorkingCoursePageHtmlData",courseId:t,pageUniqueId:e},success:function(e){var t=JSON.parse(e),a=t.status,o=t.pageHtml,i=t.contentPath;a||r(new Error("Something wrong from server!"));var c=document.createElement("dummy");c.innerHTML=o;var s=c.querySelector("layer#layer_main"),u=s?s.outerHTML:'<layer id="layer_main" class="layer" role="main"></layer>',l=Array.from(c.childNodes).find((function(e){return 1===e.nodeType&&"DIV"===e.tagName})),d=l&&l.getAttribute("style")?l.getAttribute("style").replace("url(content/files","url("+i+"files"):"background-color: rgb(255, 255, 255);";n({pageStyle:d,mainLayerHtml:u})}})}))},insertEditorDataToDB:function(e,n){return new Promise((function(r){$.ajax({url:"authoring_collaboration_ajax.php",type:"POST",data:{func:"InsertEditorDataToDB",courseId:t,pageUniqueId:e,data:n},success:function(){r(!0)},error:function(){r(!1)}})}))},getOwnerIdFromServer:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((function(t){$.ajax({url:"authoring_collaboration_ajax.php",type:"POST",data:{func:"GetOwnerId"},async:e,success:function(e){t(e)},error:function(){t(!1)}})}))},getUserIdFromServer:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((function(t){$.ajax({url:"authoring_collaboration_ajax.php",type:"POST",data:{func:"GetUserId"},async:e,success:function(e){t(e)},error:function(){t(!1)}})}))}})}},v=n(19);function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var O=function(e){var t=Object.entries(e).reduce((function(e,t){var n=m(t,2),r=n[0],a=n[1];switch(r){case"resourcesData":var o,i="string"==typeof a&&Object(v.isParsableJson)(a)?JSON.parse(a):a,c=[],s=[];for(var u in i){var l=a[u].path;if(!1===a[u].uploaded&&!1===a[u].delete){var d=u+"."+a[u].ext;c.push({source:l,target:d}),a[u].uploaded=!0,a[u].path=d}else!0===a[u].uploaded&&!0===a[u].delete&&s.push({source:l});!0===a[u].delete&&delete a[u]}return Object.assign(e,(y(o={},r,JSON.stringify(i)),y(o,"uploadedResources",c),y(o,"deletedResources",s),o));default:return Object.assign(e,y({},r,a))}}),{});return new Promise((function(e){$.ajax({url:"authoring_data_save.php",type:"POST",data:t,success:function(){return e(!0)},error:function(){return e(!1)}})}))};function P(e,t,n,r,a,o,i){try{var c=e[o](i),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,a)}function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){j(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var D=function(e){return I(I({},e),{},{saveContentPage:function(e){var t=e.pageUniqueId,n=e.eventName,r=e.selectedTargetsId;return new Promise((function(e){var a;(a=regeneratorRuntime.mark((function a(){var o,i;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:a.t0=n.split(".")[0],a.next="sidebar"===a.t0||"resources"===a.t0||"glossary"===a.t0?3:4;break;case 3:return a.abrupt("break",14);case 4:a.t1=n,a.next="stage.update.theme"===a.t1||"stage.save.quizBuilder"===a.t1||"all.save.quizBankPageData"===a.t1||"all.save.quizBankQuestionData"===a.t1?7:8;break;case 7:return a.abrupt("break",14);case 8:return o=creoFns.core.getRootWindowObject(),i=null!=r?r:o.GetObjsInSelection().map((function(e){return e.id})),a.next=12,o.SaveContent_page(t,!0,{eventName:n,selectedTargetsId:i});case 12:return creoFns.collaboration.ajaxControl.insertEditorDataToDB(t,{eventName:n,selectedTargetsId:i}),a.abrupt("break",14);case 14:e();case 15:case"end":return a.stop()}}),a)})),function(){var e=this,t=arguments;return new Promise((function(n,r){var o=a.apply(e,t);function i(e){P(o,n,r,i,c,"next",e)}function c(e){P(o,n,r,i,c,"throw",e)}i(void 0)}))})()}))},saveCourseData:function(e){var t=e.eventName;return new Promise((function(e){switch(t){case"stage.update.theme":Promise.all([new Promise((function(e){$.ajax({url:"authoring_theme_save.php",type:"POST",dataType:"html",data:{course_id:creoFns.courseId,courseData:JSON.stringify(window.globalCourseData)},success:function(){e()},error:function(){e()}})})),O({courseId:creoFns.courseId,courseData:JSON.stringify(window.globalCourseData)})]).then(e);break;case"stage.update.pageProperties":case"sidebar.update.theme":case"stage.update.pageSize":O({courseId:creoFns.courseId,courseData:JSON.stringify(window.globalCourseData)}).then(e);break;case"stage.update.dimension":O({courseId:creoFns.courseId,courseData:JSON.stringify(window.globalCourseData),pageData:JSON.stringify(window.globalPageData),quizData:JSON.stringify(window.globalQuizData)}).then(e);break;case"stage.save.quizBuilder":case"stage.update.quizPage":O({courseId:creoFns.courseId,pageData:JSON.stringify(window.globalPageData),quizData:JSON.stringify(window.globalQuizData)}).then(e);break;case"all.save.quizBankPageData":O({courseId:creoFns.courseId,quizBankPageData:JSON.stringify(window.globalQuizBankPageData)}).then(e);break;case"all.save.quizBankQuestionData":O({courseId:creoFns.courseId,quizBankQuestionData:JSON.stringify(window.globalQuizBankQuestionData)}).then(e);break;default:switch(t.split(".")[0]){case"resources":O({courseId:creoFns.courseId,resourcesData:window.globalResourcesData}).then(e);break;case"glossary":O({courseId:creoFns.courseId,glossaryData:JSON.stringify(window.globalGlossaryData)}).then(e);break;default:e(!1)}}}))}})};function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){k(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var E=function(e){var t,n,r=null,a=null,o=null,i={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun.stunprotocol.org:3478"}]},c=function(e){console.error(e)},s={},u=function(e,n){null!=e.candidate&&r.emitMessage("message-webRTC",{type:"message",data:{ice:e.candidate,userIdentification:t,destination:n}})},l=function(e,n){s[n].pc.setLocalDescription(e).then((function(){r.emitMessage("message-webRTC",{type:"message",data:{sdp:s[n].pc.localDescription,userIdentification:t,destination:n}})})).catch(c)},d=function(e,t){"function"==typeof a&&a(e,t)},f=function(e){var t=s[e].pc.iceConnectionState;"failed"!==t&&"closed"!==t&&"disconnected"!==t||(delete s[e],"function"==typeof o&&o(e))},g=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];s[e]={pc:new RTCPeerConnection(i)},s[e].pc.onicecandidate=function(t){return u(t,e)},s[e].pc.ontrack=function(t){return d(t,e)},s[e].pc.oniceconnectionstatechange=function(){return f(e)},n.getTracks().forEach((function(t){s[e].pc.addTrack(t,n)})),t&&s[e].pc.createOffer().then((function(t){return l(t,e)})).catch(c)},p=function(e){var n=e.data.userIdentification;n===t||e.data.destination!==t&&"all"!==e.data.destination||(e.data.init&&"all"===e.data.destination?(g(n),r.emitMessage("message-webRTC",{type:"message",data:{init:!0,userIdentification:t,destination:n}})):e.data.init&&e.data.destination===t?g(n,!0):e.data.sdp?s[n].pc.setRemoteDescription(new RTCSessionDescription(e.data.sdp)).then((function(){"offer"===e.data.sdp.type&&s[n].pc.createAnswer().then((function(e){return l(e,n)})).catch(c)})).catch(c):e.data.ice&&s[n].pc.addIceCandidate(new RTCIceCandidate(e.data.ice)).catch(c))};return _(_({},e),{},{startConnectAudioCall:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a=e.getRemoteStreamCallback,o=e.peerDisconnectCallback;var i=e.userId,c=e.roomId;return r=this,new Promise((function(e,a){var o,s;null!==(o=window.navigator)&&void 0!==o&&null!==(s=o.mediaDevices)&&void 0!==s&&s.getUserMedia?window.navigator.mediaDevices.getUserMedia({video:!1,audio:!0}).then((function(r){t=i+"_"+creoFns.core.generateUUID(),e({localUserIdentification:t,localStream:n=r})})).catch(a).then((function(){r.connectSocketServer({path:"/webRTC_socket_server",query:{userId:i,roomId:c}}).then((function(){r.attachEvent("message-webRTC",p),r.emitMessage("message-webRTC",{type:"message",data:{init:!0,userIdentification:t,destination:"all"}})}))})).catch(a):a(new Error("Browser not support"))}))}})},T=n(91);t.a=function(e){var t=e.userId,n=e.courseId,r=d({}),a=w({courseId:n})({}),o=D({}),i=creoFns.R.compose(E,T.a)({}),c=Object(T.a)({});a.getCollaborationSelfInfoFromServer().then((function(e){var a,o;window.creoStore.dispatch({type:"INDEX_COLLABORATION_SET_HAVING_PARTICIPANT_PERM_STATUS",status:null!==(a=null==e?void 0:e.hasParticipantPermission)&&void 0!==a&&a}),window.creoStore.dispatch({type:"INDEX_COLLABORATION_SET_HAVING_EDITING_PERM_STATUS",status:null!==(o=null==e?void 0:e.hasEditingPermission)&&void 0!==o&&o}),Promise.all([c.connectSocketServer({path:"/editing_socket_server",query:{userId:t,roomId:n}}),i.connectSocketServer({path:"/webRTC_socket_server",query:{userId:t,roomId:n}})]).then((function(){isProjectUpdatedAtBuilder&&c.emitMessage("message-update-project-at-project-builder-signal"),c.attachEvent("message-update-project-at-project-builder-signal",(function(){alert("Project is updated. Page will be reloaded."),window.location.reload()})),window.creoStore.dispatch({type:"INDEX_COLLABORATION_SET_COLLABORATION_CONNECTION_STATUS",status:!0}),c.attachEvent("message-editing-signal",(function(e){var t=e.uniqueIds,n=e.action;n&&r.syncPage({uniqueIds:t,action:n})})),c.attachEvent("message-change-mute-status",(function(e){var t=e.userId,n=e.status;window.creoStore.dispatch({type:"INDEX_COLLABORATION_UPDATE_COLLABORATION_USERS_INFO",userId:t,userInfo:{isMute:n}})}))}))}));var s=function(e){var t=creoFns.core.getRootWindowObject().GetStageWindowObject();return Array.isArray(e)&&e.length>0&&e.every((function(e){return"string"==typeof(null==e?void 0:e.pageUniqueId)&&"string"==typeof(null==e?void 0:e.layerUniqueId)}))?e:[{pageUniqueId:creoFns.core.getUUIDFromId(t.PageDataHandler({action:"get.currentPage"}).attr("id")),layerUniqueId:creoFns.core.getUUIDFromId(t.PageDataHandler({action:"get.currentLayer"}).attr("id"))}]};return{ajaxControl:a,webRTCControl:i,editingSocketControl:c,getSocketActiveUsersInfo:function(){return new Promise((function(e){c.emitMessage("inquire-active-users-info"),c.attachEventOnce("inquire-active-users-info",(function(t){e(t)}))}))},saveCourseData:function(e){var t=e.eventName;o.saveCourseData({eventName:t})},sendSyncSignal:function(e){var t=e.saveUniqueIds,n=e.eventName,r=e.selectedTargetsId;return new Promise((function(e,a){var o=s(t);window.creoStore.getState().index.collaborationState.hasEditingPermission?(c.emitMessage("message-editing-signal",{type:"message",uniqueIds:o,selectedTargetsId:r,action:n}),e()):a()}))},saveWithoutSendSyncSignal:function(e){var t=e.saveUniqueIds,n=e.eventName,r=e.selectedTargetsId;return new Promise((function(e,a){var i=s(t);Promise.all(i.map((function(e){var t=e.pageUniqueId;return new Promise((function(e,a){"forQuizBank"===t&&"all.save.quizBankPageData"!==n&&"all.save.quizBankQuestionData"!==n?e():window.creoStore.getState().index.collaborationState.hasEditingPermission?Promise.all([o.saveContentPage({pageUniqueId:t,eventName:n,selectedTargetsId:r}),o.saveCourseData({eventName:n})]).then((function(){e()})).catch(a):a(new Error("User doesn't have editing permission."))}))}))).then(e).catch(a)}))},saveAndSendSyncSignal:function(e){var t=this,n=e.saveUniqueIds,r=e.eventName,a=e.selectedTargetsId;return new Promise((function(e,o){var i=s(n);i.every((function(e){return"forQuizBank"===e.pageUniqueId&&"all.save.quizBankPageData"!==r&&"all.save.quizBankQuestionData"!==r}))?e():t.saveWithoutSendSyncSignal({saveUniqueIds:i,eventName:r,selectedTargetsId:a}).then((function(){t.sendSyncSignal({saveUniqueIds:i,eventName:r,selectedTargetsId:a}).then(e).catch(o)})).catch(o)}))}}}},117:function(e,t,n){"use strict";n.r(t),function(e){var t=n(20),r=n(61),a=n(19),o=n(31),i=n(47),c=n(112),s=n(62),u=n(116);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g=Object(s.a)({}),p=t.a((function(e,t){var n=e.x,r=void 0===n?0:n,a=e.y,c=void 0===a?0:a,s=e.seconds,u=void 0===s?0:s,l=g.getAncestorsCouldAffectCoordinate(t).reverse().reduce((function(e,t){var n=i.domNodeCssPosition(t),r=i.domNodeCssSize(t),a=i.domNodeMatrixArray(t);return o.coordinateBeforeTransform({pointX:e.x-n.left,pointY:e.y-n.top,centerX:.5*r.width,centerY:.5*r.height,matrix:a})}),{x:r,y:c}),d=i.domNodeCssSize(t),f=i.domNodeMatrixArray(t);g.setStyleWithGsap(t,{left:l.x-.5*d.width-f[0][3],top:l.y-.5*d.height-f[1][3]},u)}));window.creoFns=d(d({},"undefined"!=typeof __TEMP_IMPORT_INFO__?__TEMP_IMPORT_INFO__:{ownerId:a.getRootWindowObject().creoFns.ownerId,userId:a.getRootWindowObject().creoFns.userId,courseId:a.getRootWindowObject().creoFns.courseId,isCollaboration:a.getRootWindowObject().creoFns.isCollaboration}),{},{core:d(d({},a),{},{setPrivateField:c.setPrivateField}),math:d(d({},o),{},{coorXDom2CoorPlane:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.getRootWindowObject().globalCourseData.visualSize.innerWidth;return o.coorXDom2CoorPlane(t)(e)},coorYDom2CoorPlane:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.getRootWindowObject().globalCourseData.visualSize.innerHeight;return o.coorYDom2CoorPlane(t)(e)},coorXCoorPlane2Dom:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.getRootWindowObject().globalCourseData.visualSize.innerWidth;return o.coorXCoorPlane2Dom(t)(e)},coorYCoorPlane2Dom:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.getRootWindowObject().globalCourseData.visualSize.innerHeight;return o.coorYCoorPlane2Dom(t)(e)}}),dom:d(d({},i),{},{setDomNodeCoordinate:p,domNodeNewHtml:i.domNodeNewHtml("layer:not([id=layer_main]), div[role], m-div[role]")}),R:r}),window.creoFns=Object(d(d({},window.creoFns),{},{ownerGlobalJsonPath:e.env.HICREO_STORAGE_FOLDER_PATH+creoFns.ownerId+"/publish/"+creoFns.courseId+"/json/",userGlobalJsonPath:e.env.HICREO_STORAGE_FOLDER_PATH+creoFns.userId+"/publish/"+creoFns.courseId+"/json/",ownerContentPath:e.env.HICREO_STORAGE_FOLDER_PATH+creoFns.ownerId+"/publish/"+creoFns.courseId+"/content/",userContentPath:e.env.HICREO_STORAGE_FOLDER_PATH+creoFns.userId+"/publish/"+creoFns.courseId+"/content/",ownerLibraryPath:e.env.HICREO_STORAGE_FOLDER_PATH+creoFns.ownerId+"/library/",userLibraryPath:e.env.HICREO_STORAGE_FOLDER_PATH+creoFns.userId+"/library/",collaboration:creoFns.isCollaboration?a.getRootWindowObject()===window?Object(u.a)({userId:creoFns.userId,courseId:creoFns.courseId}):a.getRootWindowObject().creoFns.collaboration:null}))}.call(this,n(82))},118:function(e,t,n){var r={"./core.min.js":166};function a(e){var t=o(e);return n(t)}function o(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=o,e.exports=a,a.id=118},138:function(e,t,n){var r={"./dom.min.js":139};function a(e){var t=o(e);return n(t)}function o(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=o,e.exports=a,a.id=138},140:function(e,t,n){var r={"./math.min.js":141};function a(e){var t=o(e);return n(t)}function o(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=o,e.exports=a,a.id=140},62:function(e,t,n){"use strict";var r=n(79);function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}t.a=function(e){return o(o({},e),{},{getTransformValues:function(e){var t=creoFns.R.compose(creoFns.math.matrixStringToArray,creoFns.dom.domNodeMatrixString)(e);return{rotation:creoFns.math.rotationZFromMatrixArray(t),scaling:creoFns.math.scalingFromMatrixArray(t),translation:creoFns.math.translationFromMatrixArray(t)}},getAncestorsCouldAffectCoordinate:function(e){if(!e.closest("#layer_main")&&!e.closest("hicreo_dialog"))return[];for(var t=[],n=e.parentNode;n&&"layer_main"!==n.id&&"HICREO_DIALOG"!==n.tagName;)n.getAttribute("role")&&"DIV"===n.tagName&&t.push(n),n=n.parentNode;return t},getAncestorsGsTransformCouldAffectStyle:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getAncestorsCouldAffectCoordinate(e).concat(!1!==t?e:[]).map(this.getTransformValues)},setStyleWithGsap:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=creoFns.R.curry((function(e,t){return r.a.to(e,t)}));a(e,o({ease:"none",duration:n},t))}})}},91:function(e,t,n){"use strict";(function(e){var r=n(113),a=n.n(r);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}t.a=function(t){var n=null;return c(c({},t),{},{connectSocketServer:function(t){var r=t.socketServerUrl,i=void 0===r?"".concat(e.env.HICREO_SOCKET_SERVER_URL,":").concat(e.env.HICREO_SOCKET_SERVER_PORT):r,c=t.path,s=void 0===c?"":c,u=t.query,l=void 0===u?{}:u;return new Promise((function(e,t){"string"==typeof i&&l&&"object"===o(l)||t(new TypeError("Inappropriate paramter")),null!==n?e(n):((n=a()(i,{path:s,query:l})).on("connect",(function(){e(n)})),n.on("connect_failed",(function(){n=null,t(new TypeError("connect failed"))})))}))},attachEvent:function(e,t){n&&n.on(e,t)},attachEventOnce:function(e,t){n&&n.once(e,t)},detachEvent:function(e,t){n&&n.off(e,t)},emitMessage:function(e,t){n&&n.emit(e,t)}})}}).call(this,n(82))}});